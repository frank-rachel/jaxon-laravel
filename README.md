Jaxon integration for Laravel
=============================

This package integrates the [Jaxon library](https://github.com/jaxon-php/jaxon-core) into the Laravel framework.
It works with Laravel version 6 or newer.

Installation
------------

Add the following lines in the `composer.json` file, and run the `composer update` command.
```json
"require": {
    "jaxon-php/jaxon-laravel": "^4.0"
}
```

Publish the package configuration.
```php
php artisan vendor:publish --tag=config
```

Routing and middleware
----------------------

Register the Jaxon middleware for Laravel in the `app/Http/Kernel.php` file.

```php
    protected $routeMiddleware = [
        ...
        // Jaxon middleware
        'jaxon.ajax' => \Jaxon\Laravel\Middleware\AjaxMiddleware::class,
    ];
```

Add the `jaxon.ajax` middleware to the route which processes Jaxon requests. Set the route name to `jaxon`.

The Jaxon middleware returns the response, so it must be added at the end of the middleware list.
Also, the code in this route is not supposed to be executed, unless Jaxon fails to process the request.

```php
Route::post('/jaxon', function () {
    return response()->json({}); // This is not supposed to be executed.
})->middleware(['web', 'jaxon.ajax'])->name('jaxon');
```

Configuration
-------------

The settings in the `jaxon.php` config file are separated into two sections.
The options in the `lib` section are those of the Jaxon core library, while the options in the `app` sections are those of the Laravel application.

The following options can be defined in the `app` section of the config file.

| Name | Description |
|------|---------------|
| directories | An array of directory containing Jaxon application classes |
| views   | An array of directory containing Jaxon application views |
| | | |

By default, the `views` array is empty. Views are rendered from the framework default location.
There's a single entry in the `directories` array with the following values.

| Name | Default value | Description |
|------|---------------|-------------|
| directory | app_path('Jaxon/App') | The directory of the Jaxon classes |
| namespace | \Jaxon\App  | The namespace of the Jaxon classes |
| separator | .           | The separator in Jaxon class names |
| protected | empty array | Prevent Jaxon from exporting some methods |
| | | |

The `route` option is overriden by the `core.request.uri` option of the Jaxon library.

Usage
-----

This is an example of a Laravel controller using the Jaxon library.
```php
use Jaxon\Laravel\Jaxon;

class DemoController extends Controller
{
    public function index(Jaxon $jaxon)
    {
        // Print the page
        return view('index', [
            'JaxonCss' => $jaxon->css(),
            'JaxonJs' => $jaxon->js(),
            'JaxonScript' => $jaxon->script()
        ]);
    }
}
```

Before it prints the page, the controller calls the `$jaxon->css()`, `$jaxon->js()` and `$jaxon->script()` functions to get the CSS and javascript codes generated by Jaxon, which it inserts into the page.

### The Jaxon classes

The Jaxon classes can inherit from `\Jaxon\App\CallableClass`.
By default, they are located in the `app/Jaxon/App` dir of the Laravel application, and the associated namespace is `\Jaxon\App`.

This is a simple example of a Jaxon class, defined in the `app/Jaxon/App/HelloWorld.php` file.

```php
namespace Jaxon\App;

class HelloWorld extends \Jaxon\App\CallableClass
{
    public function sayHello()
    {
        $this->response->assign('div2', 'innerHTML', 'Hello World!');
        return $this->response;
    }
}
```

Contribute
----------

- Issue Tracker: github.com/jaxon-php/jaxon-laravel/issues
- Source Code: github.com/jaxon-php/jaxon-laravel

License
-------

The package is licensed under the BSD license.
